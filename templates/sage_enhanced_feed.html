<!DOCTYPE html>
<html>
<head>
    <title>üöÄ SAGE Enhanced Feed - ZeroHedge Integration</title>
    <style>
        body { font-family: Arial; max-width: 1400px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .stats { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .feed-item { background: white; padding: 25px; margin: 15px 0; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .feed-item.has-zerohedge { border-left: 6px solid #e74c3c; background: #fdf2f2; }
        .feed-item.has-expansion { border-left: 6px solid #3498db; }
        .message-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .source { font-weight: bold; color: #2c3e50; }
        .timestamp { color: #7f8c8d; font-size: 14px; }
        .content { line-height: 1.6; margin: 15px 0; }
        .original-text { background: #ecf0f1; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .url-expansion { background: #e8f6ff; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #3498db; }
        .zerohedge-content { background: #ffeaa7; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #e17055; }
        .tags { margin: 15px 0; }
        .tag { display: inline-block; padding: 4px 8px; margin: 2px; border-radius: 12px; font-size: 12px; }
        .content-tag { background: #3498db; color: white; }
        .company-tag { background: #9b59b6; color: white; }
        .people-tag { background: #e67e22; color: white; }
        .rating-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .rating-buttons { display: flex; gap: 10px; align-items: center; }
        .rating-btn { padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .rating-btn.attention { background: #e74c3c; color: white; }
        .rating-btn.normal { background: #95a5a6; color: white; }
        .rating-btn.trash { background: #34495e; color: white; }
        .rating-btn.selected { box-shadow: 0 0 10px rgba(0,0,0,0.3); transform: scale(1.05); }
        .status { font-weight: bold; margin-left: 15px; }
        .status.rated { color: #27ae60; }
        .status.not-rated { color: #e67e22; }
        .importance { background: #f39c12; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .metrics { color: #7f8c8d; font-size: 14px; margin-top: 10px; }
        .zerohedge-badge { background: #e74c3c; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .success-badge { background: #27ae60; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ SAGE Enhanced Feed - ZeroHedge Professional Integration</h1>
        <p>Real-time feed with professional URL expansion and persistent ratings</p>
        <span class="success-badge">‚úÖ ZeroHedge Apify Active</span>
    </div>

    <div class="stats">
        <h3>üìä Enhanced Feed Statistics</h3>
        <div style="display: flex; justify-content: space-around; text-align: center;">
            <div>
                <strong>{{ total_items }}</strong><br>
                <small>Total Items</small>
            </div>
            <div>
                <strong>{{ zerohedge_count }}</strong><br>
                <small>ZeroHedge Expansions</small>
            </div>
            <div>
                <strong id="rated-count">--</strong><br>
                <small>Rated Items</small>
            </div>
            <div>
                <strong>$0.001</strong><br>
                <small>Per ZeroHedge Article</small>
            </div>
        </div>
    </div>

    <div id="feed-container">
        {% for item in feed_items %}
        <div class="feed-item {% if item.has_zerohedge %}has-zerohedge{% elif item.urls_found %}has-expansion{% endif %}" data-message-id="{{ item.id }}">
            <div class="message-header">
                <div>
                    <span class="source">{{ item.source }}</span>
                    <span class="timestamp">{{ item.timestamp }}</span>
                    {% if item.has_zerohedge %}
                        <span class="zerohedge-badge">üéØ ZeroHedge</span>
                    {% endif %}
                </div>
                <div>
                    <span class="importance">üìä {{ "%.1f"|format(item.importance_score) }}</span>
                    <span class="status {{ 'rated' if item.manual_rating else 'not-rated' }}">
                        {{ item.status }}
                    </span>
                </div>
            </div>

            {% if item.original_text != item.text %}
            <div class="original-text">
                <strong>üìù Original:</strong><br>
                {{ item.original_text }}
            </div>
            {% endif %}

            <div class="content">
                {{ item.text|replace('\n', '<br>')|safe }}
            </div>

            {% if item.urls_found %}
            <div class="metrics">
                üîó <strong>URLs Expanded:</strong> {{ item.urls_found|join(', ') }}
            </div>
            {% endif %}

            <div class="tags">
                {% for tag in item.content_tags %}
                <span class="tag content-tag">{{ tag }}</span>
                {% endfor %}
                {% for tag in item.company_tags %}
                <span class="tag company-tag">{{ tag }}</span>
                {% endfor %}
                {% for tag in item.people_tags %}
                <span class="tag people-tag">{{ tag }}</span>
                {% endfor %}
            </div>

            <div class="rating-section">
                <div class="rating-buttons">
                    <span>üìä Rate this item:</span>
                    <button class="rating-btn attention {{ 'selected' if item.manual_rating == 'attention' else '' }}" 
                            onclick="rateMessage('{{ item.id }}', 'attention')">
                        ‚≠ê Attention
                    </button>
                    <button class="rating-btn normal {{ 'selected' if item.manual_rating == 'normal' else '' }}" 
                            onclick="rateMessage('{{ item.id }}', 'normal')">
                        üëç Normal
                    </button>
                    <button class="rating-btn trash {{ 'selected' if item.manual_rating == 'trash' else '' }}" 
                            onclick="rateMessage('{{ item.id }}', 'trash')">
                        üóëÔ∏è Trash
                    </button>
                    <span class="status {{ 'rated' if item.manual_rating else 'not-rated' }}" id="status-{{ item.id }}">
                        {{ item.status }}
                    </span>
                </div>
            </div>

            {% if item.metrics %}
            <div class="metrics">
                ‚ù§Ô∏è {{ item.metrics.like_count or 0 }} | üîÑ {{ item.metrics.retweet_count or 0 }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        function rateMessage(messageId, rating) {
            console.log(`Rating message ${messageId} as ${rating}`);
            
            fetch('/api/rate_message', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    message_id: messageId,
                    rating: rating
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update UI immediately
                    const container = document.querySelector(`[data-message-id="${messageId}"]`);
                    
                    // Update button states
                    container.querySelectorAll('.rating-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    container.querySelector(`.rating-btn.${rating}`).classList.add('selected');
                    
                    // Update status
                    const statusEl = container.querySelector(`#status-${messageId}`);
                    statusEl.textContent = 'RATED';
                    statusEl.className = 'status rated';
                    
                    // Update stats
                    updateStats();
                    
                    console.log(`‚úÖ Successfully rated ${messageId} as ${rating}`);
                } else {
                    console.error('Rating failed:', data.message);
                    alert('Rating failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Rating error:', error);
                alert('Rating error: ' + error);
            });
        }
        
        function updateStats() {
            fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('rated-count').textContent = data.total_rated || 0;
            })
            .catch(error => console.error('Stats update error:', error));
        }
        
        // Update stats on page load
        updateStats();
        
        // Auto-refresh every 2 minutes
        setInterval(() => {
            location.reload();
        }, 120000);
    </script>
</body>
</html>


